*** 1- Introduction ***
---

## Deploying Node Applications

### Overview

There are two primary options for deploying Node applications:

1. Using a Platform-as-a-Service (PaaS) provider
2. Using Docker

---

## 1. Platform-as-a-Service (PaaS)

### Definition

A PaaS provider handles most of the infrastructure tasks for you.

### When to Use

Choose a PaaS if you do not want to manage:

* Servers
* Load balancers
* Reverse proxies
* Application restarts after crashes

### Common Providers

* Heroku
* Google Cloud Platform
* AWS
* Azure

Different developers prefer different providers, but Heroku is used in this course because:

* It is easy to start with
* It has strong documentation
* It provides a comprehensive set of features

### Summary

Use a PaaS if you prefer simplicity and do not want to deal with infrastructure details.

---

## 2. Docker Deployment

### Definition

Docker allows you to package your application into an image.

### When to Use

Use Docker if you:

* Want full control over your deployment
* Want to deploy to your own web servers
* Need consistent environments across machines

### How It Works

You build a Docker image of your application and deploy that image to any server you choose.

---

## Focus of This Section

This section focuses on deploying Node applications to **Heroku**.

---

*** 2- Preparing the App for Production ***
---

## Preparing a Node Application for Production

### Purpose

Before deploying the application, certain production-ready middleware should be added to improve security and performance.

---

## Required Production Packages

### 1. Helmet

* Installed using: `npm install helmet`
* Purpose: Provides security by protecting the application from well-known web vulnerabilities.
* Previously introduced in the "Express Advanced Topics" section.

### 2. Compression

* Installed using: `npm install compression`
* Purpose: Compresses HTTP responses to reduce bandwidth and improve performance.

---

## Creating the Production Startup Module

### File Setup

* Create a new file: `startup/prd.js`
* This file will contain all middleware used specifically for the production environment.

### Module Implementation

Steps inside `prod.js`:

1. Import the required packages:

   -------------------code----------------------
   const helmet = require('helmet');
   const compression = require('compression');
   -------------------code----------------------

2. Export a function that takes the Express `app` object:

   -------------------code----------------------
   module.exports = function(app) {
       app.use(helmet());
       app.use(compression());
   };
   -------------------code----------------------

3. Both `helmet` and `compression` are functions, so they must be called before passing to `app.use`.

---

## Registering the Production Module

### Modifying `index.js`

* Import the production startup module:
* Call the function and pass in the Express application object:

  -------------------code----------------------
  require("./startup/prod")(app);
  -------------------code----------------------

### Conditional Loading (Optional)

* It is possible to load this module only when `NODE_ENV` is set to `production`, but for this course it is not essential.

---

## Summary

* Installed security and performance-related middleware.
* Organized production-specific configuration inside `startup/prd.js`.
* Registered the production middleware in the main entry module.
* The application is now prepared for deployment.

Next, the lecture moves on to deployment using Heroku.


*** 3- Getting Started with Heroku ***
---

## Deploying the Vidly Application to Heroku

### Overview

To deploy a Node application to Heroku, you must complete two initial setup steps:

1. Create a Heroku account
2. Install the Heroku CLI

---

## 1. Creating a Heroku Account

* Go to the Heroku website.
* Registration is simple, free, and takes only a few seconds.

---

## 2. Installing the Heroku CLI

### How to Install

* Search for "Heroku CLI" in your browser.
* Open the first link.
* Download the installer for your operating system.

### Example Installation Methods

* macOS: Can install easily using Homebrew.
* Windows and Linux: Use the platform-specific installer provided on the site.

---

## 3. Verifying Installation

After installation, open the terminal and run:

-------------------code----------------------
heroku -v
-------------------code----------------------

* This prints the installed CLI version.
* Even if an update is available, the commands shown in the lecture work with different versions.

---

## 4. Logging into Heroku

Use the following command:

-------------------code----------------------
heroku login
-------------------code----------------------

* Enter the email and password used for your Heroku account.
* Successful login will display a confirmation message.

---

## 5. Handling Login Issues (Proxy Settings)

If login fails due to a firewall or proxy:

### Set the Proxy Environment Variable

For macOS or Linux:

-------------------code----------------------
export HTTP_PROXY=http://proxy.server.com:port
-------------------code----------------------

For Windows:

-------------------code----------------------
set HTTP_PROXY=http://proxy.server.com:port
-------------------code----------------------

After setting the proxy variable, run `heroku login` again.

---

## Summary

* Create a Heroku account.
* Install and verify the Heroku CLI.
* Log in using your Heroku credentials.
* If behind a firewall, configure proxy settings.
* After these steps, the application will be ready for deployment preparation.

Next steps involve preparing the Vidly application for deployment to Heroku.


*** 4- Preparing the App for Heroku ***

---

## Preparing the Application for Deployment to Heroku

To deploy a Node application to Heroku, a few key updates must be made in `package.json`.

---

## 1. Define the Start Script

### Why This Is Needed

* Heroku starts applications by running `npm start`.
* If no `start` script is defined in `package.json`, Heroku will not know how to launch the app.

### Action

In `package.json`, under the `scripts` section, add:

-------------------code----------------------
"start": "node index.js"
-------------------code----------------------

Notes:

* Use `node`, not `nodemon`.
* `nodemon` is for development only; it watches file changes and restarts automatically.
* Production should always use `node`.

### Test Locally

Run:

-------------------code----------------------
npm start
-------------------code----------------------

You should see confirmation that the application starts and listens on port 3000.

---

## 2. Specify the Node Version (Engines Section)

### Why This Is Needed

* Heroku uses this information to match your Node runtime environment.
* Ensures your application runs with the correct version of Node.

### Action

1. Check your local Node version:

   -------------------code----------------------
   node -v
   -------------------code----------------------
2. Add the `engines` section in `package.json`:

-------------------code----------------------
"engines": {
  "node": "your_version_here"
}
-------------------code----------------------

Example:

-------------------code----------------------
"node": "8.9.1"
-------------------code----------------------

Use your actual version.

---

## Summary

To make the application ready for Heroku deployment:

1. Add a `start` script to run `node index.js` in production.
2. Add an `engines` section to specify the Node version.

With these changes, the application is fully prepared for deployment to Heroku.

PS: when we have error to let the nodemon to stop restarts during development

Create a nodemon.json file:
-------------------code----------------------
{
  "ignore": ["*.log"]
}
-------------------code----------------------

This prevents nodemon from restarting when log files change.

*** 5- Adding the Code to a Git Repository  ***


---

## Preparing the Application for Deployment to Heroku with Git

Before deploying to Heroku, the application must be inside a Git repository.

---

### 1. Install Git

* Go to [git-scm.com](https://git-scm.com) and download the installer for your operating system.
* After installation, verify it by running:

-------------------code----------------------
git --version
-------------------code----------------------

---

### 2. Initialize a Git Repository

In the root of your project folder (`vidly`), run:

-------------------code----------------------
git init
-------------------code----------------------

* This creates an empty Git repository in your project.

---

### 3. Create a `.gitignore` File

* In the root of your project, create a file named `.gitignore`.
* Purpose: Exclude certain files and folders from being tracked by Git.

Example contents:

-------------------code----------------------
node_modules/
coverage/
-------------------code----------------------

* `node_modules/` is excluded because it contains thousands of files and can be restored using `npm install`.
* `coverage/` is excluded because it contains code coverage reports generated by tests.

---

### 4. Stage Files for Commit

Run:

-------------------code----------------------
git add .
-------------------code----------------------

* Stages all files for commit, except those listed in `.gitignore`.

---

### 5. Commit the Changes

Run:

-------------------code----------------------
git commit -m "First commit"
-------------------code----------------------

* Creates the initial commit in your repository with the message `"First commit"`.

---

### Next Steps

* In the next lecture, you will learn how to use the **Heroku CLI** to deploy the application.
